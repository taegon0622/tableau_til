## **ğŸ“Œ Week 1: ìœˆë„ìš° í•¨ìˆ˜ (Window Functions)**

---

### **1ï¸âƒ£ ì£¼ìš” ê°œë…**

- **ìœˆë„ìš° í•¨ìˆ˜ (Window Functions)**:
    - `ROW_NUMBER()`, `RANK()`, `DENSE_RANK()`
    - `LAG()`, `LEAD()`
    - `SUM() OVER()`, `AVG() OVER()`
    - `PARTITION BY`, `ORDER BY` ë“±
- í•´ë‹¹ ë¬¸ë²•ì˜ ê°œë…ê³¼ ì‚¬ìš© ì‹œ ì£¼ì˜í•  ì ë“¤ì„ ì •ë¦¬í•˜ì—¬ ê¹ƒí—ˆë¸Œì— ì •ë¦¬í•´ ì£¼ì„¸ìš”.

---

### **2ï¸âƒ£ ê³¼ì œ ì•ˆë‚´**

ê° ê°œë…ì— ëŒ€í•´ ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ì •ë¦¬í•˜ê³ , í•´ë‹¹ ê°œë…ì„ í™œìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ì„¸ìš”.

### **âœ… ìœˆë„ìš° í•¨ìˆ˜ (Window Functions) í•™ìŠµ ë° ë¬¸ì œ í’€ì´**

ğŸ“– **ê³µì‹ ë¬¸ì„œ ì •ë¦¬í•˜ê¸°**

- **[ê³µì‹ ë¬¸ì„œ ì •ë¦¬ ë²”ìœ„]: ì•„ë˜ì˜ ìˆœì„œëŒ€ë¡œ ë‚´ìš©ì„ í™•ì¸í•˜ì‹œë©´ ì •ë¦¬ì— ë„ì›€ì´ ë˜ì‹¤ ê²ë‹ˆë‹¤.** ë°˜ë“œì‹œ **ëª¨ë“  ë‚´ìš©ì„ ì •ë¦¬í•  í•„ìš”ëŠ” ì—†ìœ¼ë©°** ë³¸ì¸ì—ê²Œ ë„ì›€ì´ ë  ë§Œí•œ ìƒˆë¡œ ë°°ìš´ ë‚´ìš©ë“¤ì„ ì •ë¦¬í•´ì£¼ì‹œë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.
    - ğŸ”— [MySQL ê³µì‹ ë¬¸ì„œ - 14.20.2. Window Function Concepts and Syntax](https://dev.mysql.com/doc/refman/8.0/en/window-functions-usage.html)

### 14.20.2 ìœˆë„ìš° í•¨ìˆ˜ ê°œë…ê³¼ ë¬¸ë²•

```sql
1) ìœˆë„ìš° í•¨ìˆ˜: ê° í–‰ì— ëŒ€í•´ ê²°ê³¼ë¥¼ ìƒì„±í•˜ë©´ì„œë„ ê·¸ë£¹ ë‚´ ë‹¤ë¥¸ í–‰ ì •ë³´ë„ í•¨ê»˜ í™œìš©í•¨

2) ìœˆë„ìš° í•¨ìˆ˜ëŠ” ê·¸ë£¹ì„ í•˜ë‚˜ì˜ í–‰ìœ¼ë¡œ ì¤„ì´ì§€ ì•Šê³ , ëª¨ë“  í–‰ì— ëŒ€í•´ ì—°ì‚°ì„ ìˆ˜í–‰í•¨.

3) ìœˆë„ìš° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” OVER() ì ˆì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
SUM(), AVG(), COUNT() ê°™ì€ ì§‘ê³„ í•¨ìˆ˜ë„ OVER()ë¥¼ ì‚¬ìš©í•˜ë©´ ìœˆë„ìš° í•¨ìˆ˜ë¡œ í™œìš© ê°€ëŠ¥
RANK(), DENSE_RANK(), ROW_NUMBER() ê°™ì€ ìˆœìœ„ í•¨ìˆ˜ëŠ” OVER() ì ˆì´ í•„ìˆ˜

```


    - ğŸ”— [MySQL ê³µì‹ ë¬¸ì„œ - 14.20.1. Window Function Descriptions](https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html)

### 14.20.1 ì£¼ìš” ìœˆë„ìš° í•¨ìˆ˜

```sql
![ìŠ¤í¬ë¦°ìƒ·](./SQL_1ì£¼ì°¨/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º%202025-03-21%20á„‹á…©á„’á…®%203.26.12.png)
ì¼ë¶€ ìœˆë„ìš° í•¨ìˆ˜ëŠ” NULL ê°’ ì²˜ë¦¬(null_treatment) ì ˆì„ í—ˆìš©í•˜ëŠ”ë°, MySQLì—ì„œëŠ” RESPECT NULLSë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

CUME_DIST() : ê·¸ëƒ¥ ëˆ„ì ë¸í¬ì„
(í˜„ì¬ í–‰ë³´ë‹¤ ì•ì— ìˆê±°ë‚˜ ê°™ì€ ê°’ ê°œìˆ˜) Ã· (ì „ì²´ í–‰ ê°œìˆ˜)
ë°˜í™˜ ê°’ ë²”ìœ„: 0 ~ 1
ORDER BY ì ˆê³¼ í•¨ê»˜ ì‚¬ìš©í•´ì•¼ ì˜ë¯¸ ìˆëŠ” ê°’ì„ ì–»ì„ ìˆ˜ ìˆìŒ.


LEAD(expr, N, default) : í˜„ì¬ í–‰ë³´ë‹¤ Nê°œ ë’¤ì— ìˆëŠ” í–‰ì˜ ê°’ì„ ë°˜í™˜


ex) val -> 2
SELECT
    t, val,
    LAG(val)        OVER w AS 'lag',
    LEAD(val)       OVER w AS 'lead',
    val - LAG(val)  OVER w AS 'lag diff',
    val - LEAD(val) OVER w AS 'lead diff'
FROM series
WINDOW w AS (ORDER BY t);


NTH_VALUE(expr, N) : í˜„ì¬ ìœˆë„ìš° í”„ë ˆì„ì—ì„œ Në²ˆì§¸ í–‰ì˜ ê°’ì„ ë°˜í™˜

NTILE(N) : ìœˆë„ìš° ë‚´ ë°ì´í„°ë¥¼ Nê°œì˜ ê·¸ë£¹(ë²„í‚·)ìœ¼ë¡œ ë‚˜ëˆˆ í›„, í˜„ì¬ í–‰ì´ ì†í•œ ë²„í‚· ë²ˆí˜¸ë¥¼ ë°˜í™˜


```



    - (ğŸ”— [MySQL ê³µì‹ ë¬¸ì„œ - 14.20.4. Named Windows](https://dev.mysql.com/doc/refman/8.0/en/window-functions-named-windows.html) ) - OPTIONAL

### 14.20.4 named ìœˆë„ìš° í•¨ìˆ˜
```sql
SELECT
  val,
  ROW_NUMBER() OVER (ORDER BY val) AS 'row_number',
  RANK()       OVER (ORDER BY val) AS 'rank',
  DENSE_RANK() OVER (ORDER BY val) AS 'dense_rank'
FROM numbers;


í•˜ê¸° ë°©ì‹ìœ¼ë¡œ ì‘ì„±ê°€ëŠ¥
SELECT
  val,
  ROW_NUMBER() OVER w AS 'row_number',
  RANK()       OVER w AS 'rank',
  DENSE_RANK() OVER w AS 'dense_rank'
FROM numbers
WINDOW w AS (ORDER BY val);

ì¦‰ ë°‘ì— ìœˆë„ìš° í•¨ìˆ˜ë¥¼ ì •ì˜í•¨ì— ë”°ë¼ í¸ë¦¬í•˜ê²Œ ì‘ì„±


```


    - ğŸ”— [MySQL ê³µì‹ ë¬¸ì„œ - 14.19.1. Aggregate Function Descriptions](https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html)

### 14.19.1 ì§‘ê³„ ìœˆë„ìš° í•¨ìˆ˜

```sql
AVG([DISTINCT] expr) [over_clause]
over_clauseê°€ í¬í•¨ë˜ë©´ ìœˆë„ìš° í•¨ìˆ˜ë¡œ ì‹¤í–‰ë˜ì§€ë§Œ, DISTINCTì™€ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ.

ì „ì²´ì ìœ¼ë¡œ over_clause ì‚¬ìš©í•˜ëŠ” ê²½ìš° ìœˆë„ìš°í•¨ìˆ˜ë¡œ ì‹¤í–‰

```
        â†’ over_clauseë¥¼ ì´ìš©í•˜ì—¬ ì§‘ê³„í•¨ìˆ˜ë¥¼ ìœˆë„ìš°í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ë§Œ ê³µë¶€í•´ë³´ì„¸ìš”.
        

ğŸ“ **ë¬¸ì œ í’€ì´**:

- ğŸ”— [LeetCode - Rank Scores](https://leetcode.com/problems/rank-scores/description/) `DENSE_RANK()`


![ìŠ¤í¬ë¦°ìƒ·](./SQL_1ì£¼ì°¨/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º%202025-03-21%20á„‹á…©á„’á…®%203.08.38.png)


```sql
select score, 
DENSE_RANK() OVER (ORDER BY score DESC) AS 'rank'
from Scores;
```

```
dense_rankì™€ ìì£¼ ì“°ì´ëŠ” partition byë¥¼ idì— ì ìš©í•˜ë©´ ë‹¹ì—°íˆ ë‹¤ë¥¸ ê²°ê³¼ ë„ì¶œ
```


- ğŸ”— [Solvesql - ë‹¤ìŒë‚ ë„ ì„œìš¸ìˆ²ì˜ ë¯¸ì„¸ë¨¼ì§€ ë†ë„ëŠ” ë‚˜ì¨ ğŸ˜¢](https://solvesql.com/problems/bad-finedust-measure/) `LEAD()`

![ìŠ¤í¬ë¦°ìƒ·](./SQL_1ì£¼ì°¨/á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º%202025-03-21%20á„‹á…©á„’á…®%2010.21.02.png)


```sql
select
  measured_at as today,
  DATE(measured_at, '+1 day') as next_day,
  pm10,
  next_value as next_pm10
FROM
  (
    select
      measured_at,
      pm10,
      LEAD(pm10, 1) OVER (
        ORDER BY
          measured_at
      ) AS next_value
    from
      measurements
  )
where
  pm10 < next_value
```

```
sqllite ì—ì„œ ë‚ ì§œ ë”í•˜ëŠ” ê±°ì— ìˆì–´ì„œ ì• ë¥¼ ì¢€ ë¨¹ì—ˆë‹¤
```


- ğŸ”— [programmers - ê·¸ë£¹ë³„ ì¡°ê±´ì— ë§ëŠ” ì‹ë‹¹ ëª©ë¡ ì¶œë ¥í•˜ê¸°](https://school.programmers.co.kr/learn/courses/30/lessons/131124) (ë„ì „!!)
    
    â†’ ë¬¸ì œë¥¼ í‘¸ëŠ” ë‹¤ì–‘í•œ ë°©ì‹ì´ ìˆì§€ë§Œ, **ìœˆë„ìš° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬** í•´ê²°í•˜ëŠ” ë°©ì‹ì— ëŒ€í•´ ê³ ë¯¼í•´ ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.
    
    *DATE í˜•ì‹ì„ ë¬¸ì œì˜ ì¡°ê±´ì— ë§ê²Œ ì‘ì„±í•´ì£¼ì–´ì•¼ í†µê³¼ë˜ë¯€ë¡œ, DATE_FORMATì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”~
```sql
SELECT A.MEMBER_NAME,REVIEW_TEXT, DATE_FORMAT(REVIEW_DATE,'%Y-%m-%d') as REVIEW_DATE  from MEMBER_PROFILE A
inner join REST_REVIEW B 
on A.MEMBER_ID = B.MEMBER_ID
where B.MEMBER_ID in(
select MEMBER_ID from REST_REVIEW
group by MEMBER_ID
having count(REVIEW_TEXT) = 3

)
order by REVIEW_DATE asc, REVIEW_TEXT asc

```